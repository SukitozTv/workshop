<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SystemSchool — Full Docs</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Prism light theme -->
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css" rel="stylesheet">

  <style>
    :root{
      --bg:#ffffff; --text:#111827; --muted:#6b7280;
      --border:#e5e7eb; --border-strong:#d1d5db;
      --code-bg:#f6f6f6; --code-fg:#0f172a;
      --chip:#eef2ff; --chip-text:#3730a3;
    }
    html{scroll-behavior:smooth}
    body{background:var(--bg);color:var(--text)}

    .navbar{background:#fff;border-bottom:1px solid var(--border)}
    .hero{background:#fff;padding:2rem 0;border-bottom:1px solid var(--border)}
    .sidebar{position:sticky;top:76px;height:calc(100vh - 86px)}
    .toc{background:#fff;border:1px solid var(--border);border-radius:12px;padding:14px}
    .toc h6{font-size:.9rem;margin:.4rem 0}
    .card{border:1px solid var(--border);border-radius:12px}
    .card-header{background:#f8fafc;border-bottom:1px solid var(--border-strong)}
    .copy-btn{border:1px solid var(--border-strong)!important}
    .chip{display:inline-block;padding:.2rem .55rem;border-radius:999px;background:var(--chip);color:var(--chip-text);font-size:.75rem}

    pre[class*="language-"], code[class*="language-"]{
      background:var(--code-bg)!important;color:var(--code-fg)!important;
      border:1px solid var(--border);border-radius:10px;font-size:.93rem;line-height:1.5
    }

    /* กล่องคำอธิบาย: เปิดค่าเริ่มต้น และเขียนให้อ่านง่าย */
    details.explain{background:#f8fafc;border:0;border-radius:12px;margin-top:.5rem;box-shadow: inset 0 1px 0 rgba(0,0,0,.03)}
    details.explain > summary{list-style:none;cursor:pointer;padding:.75rem .95rem;font-weight:700}
    details.explain > summary::marker, details.explain > summary::-webkit-details-marker{display:none}
    details.explain > summary::before{content:'▾';display:inline-block;margin-right:.4rem;color:#64748b;transition:transform .2s}
    details.explain[open] > summary::before{transform:rotate(180deg)}
    details.explain .body{padding:.1rem .95rem .9rem}
    details.explain .body p{margin-bottom:.4rem}
    details.explain .body ul{margin-bottom:0}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="#"><i class="bi bi-stack me-2"></i>SystemSchool Docs</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="#database">Database</a></li>
          <li class="nav-item"><a class="nav-link" href="#backend">Backend</a></li>
          <li class="nav-item"><a class="nav-link" href="#frontend">Frontend</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero">
    <div class="container">
      <h1 class="h3 fw-bold mb-2">SystemSchool — Vue 3 + Node.js + MySQL</h1>
      <p class="mb-1 text-secondary">
        โครงสร้างแยกชัดเจน: <b>Backend</b> (middlewares / routes / services / controllers / utils) |
        <b>Frontend</b> (components / pages / router / api)
      </p>
      <div class="d-flex gap-2 mt-2">
        <span class="chip">CRUD ครบ</span>
        <span class="chip">อัปโหลดรูปครู</span>
        <span class="chip">JOIN ตำแหน่ง</span>
      </div>
    </div>
  </header>

  <main class="container my-4">
    <div class="row g-4">

      <!-- SIDEBAR -->
      <aside class="col-lg-3 d-none d-lg-block">
        <div class="sidebar">
          <div class="toc">
            <h6>Database</h6>
            <ol class="mb-3"><li><a href="#database">Schema & Seed</a></li></ol>
            <h6>Backend</h6>
            <ol class="mb-3">
              <li><a href="#backend-structure">โครงสร้าง</a></li>
              <li><a href="#backend-run">สร้างโปรเจกต์ & วิธีรัน</a></li>
              <li><a href="#backend-code">โค้ดทุกไฟล์ + คำอธิบาย</a></li>
            </ol>
            <h6>Frontend</h6>
            <ol class="mb-0">
              <li><a href="#frontend-structure">โครงสร้าง</a></li>
              <li><a href="#frontend-run">สร้างโปรเจกต์ & วิธีรัน</a></li>
              <li><a href="#frontend-code">โค้ดทุกไฟล์ + คำอธิบาย</a></li>
            </ol>
          </div>
        </div>
      </aside>

      <!-- CONTENT -->
      <section class="col-lg-9">

        <!-- DATABASE -->
        <div id="database" class="mb-5">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h2 class="h4 fw-bold mb-0">Database (MySQL)</h2>
            <button class="btn btn-sm copy-btn" onclick="copyBlock('sql', this)">คัดลอก</button>
          </div>
<pre><code id="sql" class="language-sql">CREATE DATABASE IF NOT EXISTS `workshop_3` CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE `workshop_3`;

CREATE TABLE `position` (
  `id` INT AUTO_INCREMENT PRIMARY KEY,
  `name` varchar(100) NOT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

CREATE TABLE `teacher` (
  `id` INT AUTO_INCREMENT PRIMARY KEY,
  `name` varchar(100) NOT NULL,
  `address` text DEFAULT NULL,
  `telephone` varchar(20) DEFAULT NULL,
  `img` varchar(255) DEFAULT NULL,
  `position_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

INSERT INTO `position` (`id`, `name`, `created_at`, `updated_at`) VALUES
(1, 'ผู้จัดการโรงเรียน', '2025-09-02 03:58:37', '2025-09-02 04:17:01'),
(2, 'อาจารย์ประจำ', '2025-09-02 03:58:37', '2025-09-02 03:58:37'),
(3, 'อาจารย์ฝึกหัด', '2025-09-02 03:58:37', '2025-09-02 03:58:37'),
(4, 'ผู้ช่วยครู', '2025-09-02 03:58:37', '2025-09-02 03:58:37'),
(5, 'ที่ปรึกษาการศึกษา', '2025-09-02 03:58:37', '2025-09-02 03:58:37'),
(6, 'อาจารย์ศิลปศึกษา', '2025-09-02 03:58:37', '2025-09-02 03:58:37'),
(7, 'อาจารย์ดนตรี', '2025-09-02 03:58:37', '2025-09-02 03:58:37'),
(8, 'อาจารย์เทคโนโลยี', '2025-09-02 03:58:37', '2025-09-02 03:58:37');

INSERT INTO `teacher` (`id`, `name`, `address`, `telephone`, `img`, `position_id`, `created_at`, `updated_at`) VALUES
(12, 'วิชัย สุวรรณ', '123/1 ม.1 ต.ในเมือง อ.เมือง จ.เพชรบูรณ์', '012-3456789', '', 1, '2025-09-02 04:17:33', '2025-09-02 04:17:33'),
(14, 'ประสงค์ ไพรวัลย์', '123/3 ม.1 ต.ในเมือง อ.เมือง จ.เพชรบูรณ์', '012-3456789', '', 3, '2025-09-02 04:17:33', '2025-09-02 04:17:33'),
(15, 'จันทิมา ดวงเด่น', '123/4 ม.1 ต.ในเมือง อ.เมือง จ.เพชรบูรณ์', '012-3456789', '', 2, '2025-09-02 04:17:33', '2025-09-02 04:17:33'),
(16, 'สมพงษ์ สุขสวัสดิ์', '123/5 ม.1 ต.ในเมือง อ.เมือง จ.เพชรบูรณ์', '012-3456789', '', 4, '2025-09-02 04:17:33', '2025-09-02 04:17:33');
</code></pre>
          <details class="explain" open><summary>คำอธิบายสั้น กระชับ และตรงประเด็น</summary><div class="body">
            <ul class="mb-0">
              <li>สร้าง DB <code>workshop_3</code> + ตาราง <code>position</code> และ <code>teacher</code> พร้อม seed</li>
              <li>คอลัมน์ <code>img</code> เก็บพาธแบบสัมพัทธ์ เช่น <code>teacher_image/xxx.png</code> เพื่อเสิร์ฟเป็น Static</li>
              <li>ถ้าต้อง “บังคับ” ว่าครูต้องอ้างอิงตำแหน่งที่มีอยู่จริง ให้เพิ่ม Foreign Key (ดูคอมเมนต์ใน SQL)</li>
            </ul>
          </div></details>
        </div>

        <!-- BACKEND -->
        <div id="backend" class="mb-3"><h2 class="h4 fw-bold">Backend (Node.js + Express)</h2></div>

        <div id="backend-structure" class="mb-4">
<pre><code class="language-bash">server/
|-- src/
|   |-- config/
|   |   -- db.js
|   |-- controllers/
|   |   |-- position.controller.js
|   |   |-- teacher.controller.js
|   |-- middlewares/
|   |   |-- asyncHandler.js
|   |   |-- errorHandler.js
|   |   |-- uploadImage.js
|   |-- routes/
|   |   |-- index.js
|   |   |-- position.routes.js
|   |   |-- teacher.routes.js
|   |-- services/
|   |   |-- position.service.js
|   |   |-- teacher.service.js
|   |-- utils/
|       -- file.js
|-- public/teacher_image/
|-- src/app.js
|-- .env
|-- package.json
</code></pre>
          <details class="explain" open><summary>อธิบายภาพรวมแบบเข้าใจง่าย</summary><div class="body">
            <ul class="mb-0">
              <li><b>controllers</b> ตรวจ/รับค่า <code>req</code> → เรียก <b>services</b> → ตอบ <code>res</code></li>
              <li><b>services</b> คุย DB ล้วน (ไม่มี HTTP) → โค้ดสะอาด แก้ทีหลังง่าย</li>
              <li><b>middlewares</b> ใช้ซ้ำได้ เช่น async/error, อัปโหลดรูป</li>
              <li><b>public/teacher_image</b> ที่เก็บไฟล์รูปของครู (เสิร์ฟเป็น static)</li>
            </ul>
          </div></details>
        </div>

        <div id="backend-run" class="mb-5">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h3 class="h5 fw-bold mb-0">สร้างโปรเจกต์ & วิธีรัน (Backend)</h3>
            <button class="btn btn-sm copy-btn" onclick="copyBlock('backend-setup', this)">คัดลอก</button>
          </div>
<pre><code id="backend-setup" class="language-bash">mkdir server && cd server
npm init -y
npm i express mysql2 dotenv multer cors
npm i -D nodemon
mkdir src\config src\routes src\controllers src\services src\middlewares src\utils public\teacher_image

# วางไฟล์ทั้งหมดตามส่วน "โค้ดทุกไฟล์" ด้านล่าง
npm start   # เริ่ม dev server ที่ http://localhost:3000
</code></pre>
          <details class="explain" open><summary>จุดที่มักสับสน (เคลียร์ๆ)</summary><div class="body">
            <ul class="mb-0">
              <li>ใช้ <code>npm dev</code> ในช่วงพัฒนา (มี <code>nodemon</code>) / ใช้ <code>npm start</code> ตอนรันจริง</li>
              <li><code>FRONTEND_ORIGIN</code> ใน <code>.env</code> ต้องตรงกับพอร์ตของ Vite (ปกติ <code>5173</code>) เพื่อให้ CORS ผ่าน</li>
            </ul>
          </div></details>
        </div>

        <!-- BACKEND FILES -->
        <div id="backend-code" class="mb-5">

          <!-- server/.env -->
          <div class="card mb-3"><div class="card-header d-flex justify-content-between align-items-center">
            <strong>server/.env</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-env', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-env" class="language-bash">PORT=3000
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=
DB_NAME=workshop_3
FRONTEND_ORIGIN=http://localhost:5173
</code></pre>
<details class="explain" open><summary>อธิบาย .env แบบสั้นๆ</summary><div class="body">
  <ul class="mb-0">
    <li><code>FRONTEND_ORIGIN</code> เปิด CORS สำหรับเว็บฝั่ง Vite ขณะ dev</li>
    <li>ปรับข้อมูล DB ให้ตรงเครื่องก่อนรัน</li>
  </ul>
</div></details></div>

          <!-- server/package.json -->
          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/package.json</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-pkg', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-pkg" class="language-json">{
  "name": "server",
  "version": "1.0.0",
  "type": "commonjs",
  "scripts": { "dev": "nodemon src/app.js", "start": "node src/app.js" },
  "dependencies": {
    "cors": "^2.8.5",
    "dotenv": "^17.2.1",
    "express": "^5.1.0",
    "multer": "^2.0.2",
    "mysql2": "^3.14.4"
  },
  "devDependencies": { "nodemon": "^3.1.10" }
}
</code></pre>
<details class="explain" open><summary>สรุปให้ชัด</summary><div class="body"><ul class="mb-0">
  <li><code>type: commonjs</code> → ใช้ <code>require()</code> ได้</li>
  <li><code>dev</code> = โหมดพัฒนา (auto-restart), <code>start</code> = โหมดจริง</li>
</ul></div></details></div>

          <!-- server/src/config/db.js -->
          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/config/db.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-db', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-db" class="language-javascript">const mysql = require('mysql2/promise');
const pool = mysql.createPool({
  host: process.env.DB_HOST,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD || '',
  database: process.env.DB_NAME,
  waitForConnections: true,
  connectionLimit: 10
});
module.exports = { pool };
</code></pre>
<details class="explain" open><summary>เข้าใจใน 2 บรรทัด</summary><div class="body"><ul class="mb-0">
  <li>ใช้ <b>connection pool</b> เพื่อประสิทธิภาพและความเสถียร</li>
  <li>ทุก service เรียก <code>pool.query(sql, params)</code> ได้ทันที</li>
</ul></div></details></div>

          <!-- server/src/app.js -->
          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/app.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-app', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-app" class="language-javascript">require('dotenv').config();
const path = require('path'); const fs = require('fs');
const express = require('express'); const cors = require('cors');
const routes = require('./routes');
const { notFound, errorHandler } = require('./middlewares/errorHandler');

const app = express();
app.use(cors({
  origin: process.env.FRONTEND_ORIGIN || true,
  methods: ['GET','POST','PUT','DELETE','OPTIONS'],
  allowedHeaders: ['Content-Type','Authorization']
}));
app.use(express.json());

// Static image directory
const IMAGE_DIR = path.join(__dirname, '..', 'public', 'teacher_image');
if (!fs.existsSync(IMAGE_DIR)) fs.mkdirSync(IMAGE_DIR, { recursive: true });
app.use('/teacher_image', express.static(IMAGE_DIR));

app.get('/', (_req, res) => res.json({ ok: true, service: 'workshop-backend', basePath: '/api' }));
app.use('/api', routes);
app.use('/api', notFound);
app.use(errorHandler);

const port = process.env.PORT || 3000;
app.listen(port, () => console.log(`API running at http://localhost:${port}`));
</code></pre>
<details class="explain" open><summary>สิ่งสำคัญที่ควรรู้</summary><div class="body"><ul class="mb-0">
  <li>เปิด CORS ตาม <code>FRONTEND_ORIGIN</code> และรับ JSON body</li>
  <li>เสิร์ฟรูปจาก <code>/teacher_image</code> (อยู่ใน <code>public</code>)</li>
  <li><code>notFound</code> และ <code>errorHandler</code> ต้องวางท้ายสุด</li>
</ul></div></details></div>

          <!-- middlewares -->
          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/middlewares/asyncHandler.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-async', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-async" class="language-javascript">module.exports = (fn) => (req, res, next) => Promise.resolve(fn(req, res, next)).catch(next);
</code></pre>
<details class="explain" open><summary>ทำไมต้องมีไฟล์นี้?</summary><div class="body">
  <ul class="mb-0"><li>ลดการเขียน <code>try/catch</code> ซ้ำๆ ใน controller → โค้ดสั้นลง</li></ul>
</div></details></div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/middlewares/errorHandler.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-err', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-err" class="language-javascript">const notFound = (req,_res,next)=>{ const err=new Error(`Not Found - ${req.originalUrl}`); err.status=404; next(err); };
const errorHandler = (err,_req,res,_next)=>{ const status=err.status||500;
  const payload={ message: status===404?'Endpoint not found':'Internal server error' };
  res.status(status).json(payload);
};
module.exports={ notFound, errorHandler };
</code></pre>
<details class="explain" open><summary>ผลลัพธ์เมื่อ error</summary><div class="body">
  <ul class="mb-0"><li>ตอบกลับเป็น JSON รูปแบบเดียวกัน (คาดเดาได้ง่าย)</li></ul>
</div></details></div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/middlewares/uploadImage.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-up', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-up" class="language-javascript">const multer=require('multer'); const path=require('path'); const fs=require('fs');
const uploadDir=path.join(__dirname,'..','..','public','teacher_image'); if(!fs.existsSync(uploadDir)) fs.mkdirSync(uploadDir,{recursive:true});
const storage=multer.diskStorage({
  destination:(_req,_file,cb)=>cb(null,uploadDir),
  filename:(_req,file,cb)=>{ const ext=path.extname(file.originalname).toLowerCase(); const name=Date.now()+'_'+Math.random().toString(36).slice(2)+ext; cb(null,name); }
});
const fileFilter=(_req,file,cb)=>{ const ok=['image/jpeg','image/jpg','image/png','image/webp'].includes(file.mimetype); cb(ok?null:new Error('jpeg/png/webp only'), ok); };
const uploadSingleImage=multer({ storage, fileFilter, limits:{ fileSize:2*1024*1024 } }).single('image');
module.exports={ uploadSingleImage };
</code></pre>
<details class="explain" open><summary>ข้อกำหนดไฟล์รูป</summary><div class="body">
  <ul class="mb-0">
    <li>รับเฉพาะ <code>jpeg/png/webp</code> และจำกัดขนาด 2MB</li>
    <li>ฟิลด์ไฟล์ในฟอร์มชื่อ <code>image</code></li>
  </ul>
</div></details></div>

          <!-- utils/file.js -->
          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/utils/file.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-util', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-util" class="language-javascript">const fs = require('fs'); const path = require('path');
/** ลบไฟล์จากโฟลเดอร์ public อย่างปลอดภัย (ไม่ throw) */
function unlinkSafe(relativePath){
  try{
    if(!relativePath) return;
    const base = path.resolve(__dirname, '..', '..', 'public');
    const target = path.resolve(base, relativePath);
    if(!target.startsWith(base)) return; // กัน path traversal
    if(fs.existsSync(target)) fs.unlinkSync(target);
  }catch(_e){ /* do nothing */ }
}
module.exports = { unlinkSafe };
</code></pre>
<details class="explain" open><summary>เหตุผลที่ต้อง “safe”</summary><div class="body">
  <ul class="mb-0"><li>กันการลบไฟล์นอกโฟลเดอร์ด้วยการตรวจ <code>startsWith(base)</code> (ป้องกัน path traversal)</li></ul>
</div></details></div>

          <!-- routes -->
          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/routes/index.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-ridx', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-ridx" class="language-javascript">const express = require('express');
const teacherRoutes = require('./teacher.routes');
const positionRoutes = require('./position.routes');
const router = express.Router();
router.use('/teachers', teacherRoutes);
router.use('/positions', positionRoutes);
module.exports = router;
</code></pre>
<details class="explain" open><summary>รวม route ไว้จุดเดียว</summary><div class="body">
  <ul class="mb-0"><li>ถูก mount ที่ <code>/api</code> ใน <code>app.js</code> → endpoint จริงเช่น <code>GET /api/teachers</code></li></ul>
</div></details></div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/routes/position.routes.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-pro', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-pro" class="language-javascript">const express = require('express');
const ctrl = require('../controllers/position.controller');
const router = express.Router();
router.get('/', ctrl.list);
router.get('/:id', ctrl.getOne);
router.post('/', ctrl.create);
router.put('/:id', ctrl.update);
router.delete('/:id', ctrl.remove);
module.exports = router;
</code></pre>
<details class="explain" open><summary>ตำแหน่ง: CRUD ครบ</summary><div class="body">
  <ul class="mb-0"><li>ควบคุมสถานะ HTTP ที่ controller (201/404/204 ฯลฯ)</li></ul>
</div></details></div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/routes/teacher.routes.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-tr', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-tr" class="language-javascript">const express = require('express');
const ctrl = require('../controllers/teacher.controller');
const { uploadSingleImage } = require('../middlewares/uploadImage');
const router = express.Router();
router.get('/', ctrl.list);
router.get('/:id', ctrl.getOne);
router.post('/', uploadSingleImage, ctrl.create);
router.put('/:id', uploadSingleImage, ctrl.update);
router.delete('/:id', ctrl.remove);
module.exports = router;
</code></pre>
<details class="explain" open><summary>ครู: รองรับอัปโหลดรูป</summary><div class="body">
  <ul class="mb-0"><li>ถ้ามีไฟล์แนบ จะผ่าน <code>uploadSingleImage</code> ก่อนถึง controller</li></ul>
</div></details></div>

          <!-- controllers -->
          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/controllers/position.controller.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-cp', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-cp" class="language-javascript">const asyncHandler = require('../middlewares/asyncHandler');
const svc = require('../services/position.service');
exports.list = asyncHandler(async (_req, res) => { res.json(await svc.listPositions()); });
exports.getOne = asyncHandler(async (req, res) => {
  const found = await svc.getPositionById(req.params.id);
  if (!found) return res.status(404).json({ message: 'Position not found' });
  res.json(found);
});
exports.create = asyncHandler(async (req, res) => {
  const name = (req.body?.name || '').trim();
  if (!name) return res.status(400).json({ message: 'กรุณากรอกชื่อตำแหน่ง' });
  const created = await svc.createPosition(name);
  res.status(201).json(created);
});
exports.update = asyncHandler(async (req, res) => {
  const name = (req.body?.name || '').trim();
  if (!name) return res.status(400).json({ message: 'กรุณากรอกชื่อตำแหน่ง' });
  const ok = await svc.updatePosition(req.params.id, name);
  if (!ok) return res.status(404).json({ message: 'Position not found' });
  res.json(await svc.getPositionById(req.params.id));
});
exports.remove = asyncHandler(async (req, res) => {
  const ok = await svc.deletePosition(req.params.id);
  if (!ok) return res.status(404).json({ message: 'Position not found or in use' });
  res.status(204).send();
});
</code></pre>
<details class="explain" open><summary>เหตุผลของสถานะ HTTP</summary><div class="body">
  <ul class="mb-0">
    <li><code>201</code> สร้างสำเร็จ, <code>404</code> ไม่พบข้อมูล, <code>204</code> ลบสำเร็จ (ไม่ต้องมี body)</li>
  </ul>
</div></details></div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/controllers/teacher.controller.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-ct', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-ct" class="language-javascript">const asyncHandler = require('../middlewares/asyncHandler');
const svc = require('../services/teacher.service');
const fs = require('fs'); const path = require('path');

exports.list = asyncHandler(async (req, res) => {
  const data = await svc.listTeachers();
  const base = `${req.protocol}://${req.get('host')}`;
  res.json(data.map(t => ({ ...t, image_url: t.img ? `${base}/${t.img}`.replace(/\/\/teacher_image/, '/teacher_image') : null })));
});

exports.getOne = asyncHandler(async (req, res) => {
  const t = await svc.getTeacherById(req.params.id);
  if (!t) return res.status(404).json({ message: 'Teacher not found' });
  const base = `${req.protocol}://${req.get('host')}`;
  t.image_url = t.img ? `${base}/${t.img}`.replace(/\/\/teacher_image/, '/teacher_image') : null;
  res.json(t);
});

exports.create = asyncHandler(async (req, res) => {
  const name = (req.body?.name || '').trim();
  const position_id = Number(req.body?.position_id || 0);
  const address = (req.body?.address || '').trim() || null;
  const telephone = (req.body?.telephone || '').trim() || null;
  if (!name || !position_id) {
    if (req.file) fs.unlink(path.join(__dirname, '..','..','public','teacher_image', req.file.filename), ()=>{});
    return res.status(400).json({ message: 'กรุณากรอก name และ position_id' });
  }
  const relativeImagePath = req.file ? `teacher_image/${req.file.filename}` : null;
  const created = await svc.createTeacher({ name, address, telephone, position_id, relativeImagePath });
  const base = `${req.protocol}://${req.get('host')}`;
  created.image_url = created.img ? `${base}/${created.img}`.replace(/\/\/teacher_image/, '/teacher_image') : null;
  res.status(201).json(created);
});

exports.update = asyncHandler(async (req, res) => {
  const payload = {
    name: req.body?.name?.trim(),
    address: (req.body?.address?.trim() || null),
    telephone: (req.body?.telephone?.trim() || null),
  };
  if (req.body?.position_id !== undefined) payload.position_id = Number(req.body.position_id);
  const relativeImagePath = req.file ? `teacher_image/${req.file.filename}` : undefined;
  const updated = await svc.updateTeacher(req.params.id, { ...payload, relativeImagePath });
  if (!updated) return res.status(404).json({ message: 'Teacher not found' });
  const base = `${req.protocol}://${req.get('host')}`;
  updated.image_url = updated.img ? `${base}/${updated.img}`.replace(/\/\/teacher_image/, '/teacher_image') : null;
  res.json(updated);
});

exports.remove = asyncHandler(async (req, res) => {
  const ok = await svc.deleteTeacher(req.params.id);
  if (!ok) return res.status(404).json({ message: 'Teacher not found' });
  res.status(204).send();
});
</code></pre>
<details class="explain" open><summary>แนวคิดการต่อ URL รูป</summary><div class="body">
  <ul class="mb-0">
    <li>ต่อจาก host ปัจจุบัน เช่น <code>http://localhost:3000/teacher_image/xxxx.webp</code> → frontend เรียกดูได้ทันที</li>
    <li>หาก validate ไม่ผ่านและมีไฟล์อัปโหลด จะลบไฟล์ทิ้งทันที (กันไฟล์ขยะ)</li>
  </ul>
</div></details></div>

          <!-- services -->
          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>server/src/services/position.service.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-sp', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-sp" class="language-javascript">const { pool } = require('../config/db');

/** ดึงรายการตำแหน่งทั้งหมด (เรียงจาก id น้อยไปมาก) */
async function listPositions(){
  const [rows] = await pool.query('SELECT id,name FROM `position` ORDER BY id ASC');
  return rows;
}

/** ดึงตำแหน่งตาม id — ถ้าไม่เจอจะคืน null */
async function getPositionById(id){
  const [rows] = await pool.query('SELECT id,name FROM `position` WHERE id=?', [id]);
  return rows[0] || null;
}

/** สร้างตำแหน่งใหม่ — คืน object {id, name} ของแถวที่เพิ่งสร้าง */
async function createPosition(name){
  const [r] = await pool.query('INSERT INTO `position` (name) VALUES (?)', [name]);
  return { id: r.insertId, name };
}

/** แก้ไขชื่อตำแหน่ง — คืน true ถ้ามีแถวถูกแก้ไข */
async function updatePosition(id, name){
  const [r] = await pool.query('UPDATE `position` SET name=? WHERE id=?', [name, id]);
  return r.affectedRows > 0;
}

/** ลบตำแหน่ง — คืน true ถ้าลบได้ */
async function deletePosition(id){
  const [r] = await pool.query('DELETE FROM `position` WHERE id=?', [id]);
  return r.affectedRows > 0;
}
module.exports = { listPositions, getPositionById, createPosition, updatePosition, deletePosition };
</code></pre>
<details class="explain" open><summary>แนวทางออกแบบ service</summary><div class="body">
  <ul>
    <li>ไม่ยุ่งกับ HTTP status → controller เป็นผู้ตัดสินใจ (ยืดหยุ่นกว่า)</li>
    <li><code>null</code> เมื่อไม่พบข้อมูล เพื่อให้ controller ส่ง 404 ได้</li>
    <li>เช็คผลด้วย <code>affectedRows</code> สำหรับ <code>UPDATE</code>/<code>DELETE</code></li>
  </ul>
</div></details></div>

          <div class="card"><div class="card-header d-flex justify-content-between">
            <strong>server/src/services/teacher.service.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('srv-st', this)">คัดลอก</button></div>
<pre class="m-0"><code id="srv-st" class="language-javascript">const { pool } = require('../config/db'); const { getPositionById } = require('./position.service'); const { unlinkSafe } = require('../utils/file');
async function listTeachers(){
  const [rows]=await pool.query(
`SELECT t.\`id\`,t.\`name\`,t.\`address\`,t.\`telephone\`,t.\`img\`,t.\`position_id\`,p.\`name\` AS position_name
 FROM \`teacher\` t LEFT JOIN \`position\` p ON p.\`id\`=t.\`position_id\` ORDER BY t.\`name\` ASC`);
  return rows;
}
async function getTeacherById(id){
  const [rows]=await pool.query(
`SELECT t.\`id\`,t.\`name\`,t.\`address\`,t.\`telephone\`,t.\`img\`,t.\`position_id\`,p.\`name\` AS position_name
 FROM \`teacher\` t LEFT JOIN \`position\` p ON p.\`id\`=t.\`position_id\` WHERE t.\`id\`=?`,[id]); return rows[0]||null;
}
async function createTeacher({name,address=null,telephone=null,position_id,relativeImagePath=null}){
  const pos=await getPositionById(position_id); if(!pos){ const e=new Error('position_id not found'); e.status=400; throw e; }
  const [r]=await pool.query(
`INSERT INTO \`teacher\` (\`name\`,\`address\`,\`telephone\`,\`img\`,\`position_id\`) VALUES (?,?,?,?,?)`,
[name,address,telephone,relativeImagePath,position_id]); return await getTeacherById(r.insertId);
}
async function updateTeacher(id,data){
  if(data.position_id!==undefined&&data.position_id!==null){ const pos=await getPositionById(data.position_id); if(!pos){ const e=new Error('position_id not found'); e.status=400; throw e; } }
  if(data.relativeImagePath){ const current=await getTeacherById(id); if(current?.img) unlinkSafe(current.img); }
  const fields=[],values=[];
  if(data.name!==undefined){ fields.push('`name`=?'); values.push(data.name); }
  if(data.address!==undefined){ fields.push('`address`=?'); values.push(data.address); }
  if(data.telephone!==undefined){ fields.push('`telephone`=?'); values.push(data.telephone); }
  if(data.position_id!==undefined){ fields.push('`position_id`=?'); values.push(data.position_id); }
  if(data.relativeImagePath!==undefined){ fields.push('`img`=?'); values.push(data.relativeImagePath); }
  if(!fields.length) return await getTeacherById(id);
  values.push(id); await pool.query(`UPDATE \`teacher\` SET ${fields.join(', ')} WHERE \`id\`=?`, values); return await getTeacherById(id);
}
async function deleteTeacher(id){
  const current=await getTeacherById(id); const [r]=await pool.query('DELETE FROM `teacher` WHERE `id`=?',[id]);
  if(r.affectedRows>0 && current?.img) unlinkSafe(current.img); return r.affectedRows>0;
}
module.exports={ listTeachers,getTeacherById,createTeacher,updateTeacher,deleteTeacher };
</code></pre>
<details class="explain" open><summary>ประเด็นสำคัญ</summary><div class="body">
  <ul class="mb-0">
    <li>JOIN กับตารางตำแหน่งเพื่อได้ <code>position_name</code> ไปแสดงผล</li>
    <li>เวลาเปลี่ยนรูปใหม่ จะลบรูปเก่าออกจากดิสก์ (ผ่าน <code>unlinkSafe</code>)</li>
  </ul>
</div></details></div>

        </div> <!-- /backend-code -->

        <!-- FRONTEND -->
        <div id="frontend" class="mb-3"><h2 class="h4 fw-bold">Frontend (Vite + Vue 3 + Bootstrap)</h2></div>

        <div id="frontend-structure" class="mb-4">
<pre><code class="language-bash">client/
|-- src/
|   |-- api/
|   |   -- index.js
|   |-- components/
|   |   |-- ConfirmModal.vue
|   |   |-- ImageUploader.vue
|   |-- pages/
|   |   |-- DashboardPage.vue
|   |   |-- PositionsPage.vue
|   |   |-- TeachersPage.vue
|   |-- router/
|   |   -- index.js
|   |-- App.vue
|   |-- main.js
|-- .env
|-- vite.config.js
|-- package.json
</code></pre>
          <details class="explain" open><summary>สิ่งที่อยากให้จำ</summary><div class="body">
            <ul class="mb-0"><li>แยก <b>pages</b> (ไฟล์ของ route) ออกจาก <b>components</b> (ชิ้นส่วนที่นำกลับมาใช้ซ้ำ)</li></ul>
          </div></details>
        </div>

        <div id="frontend-run" class="mb-5">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h3 class="h5 fw-bold mb-0">สร้างโปรเจกต์ & วิธีรัน (Frontend)</h3>
            <button class="btn btn-sm copy-btn" onclick="copyBlock('fe-setup', this)">คัดลอก</button>
          </div>
<pre><code id="fe-setup" class="language-bash">npm create vite@latest client -- --template vue
cd client
npm i
npm i axios bootstrap bootstrap-icons pinia vue-router

# โครงสร้างโฟลเดอร์
cd src && mkdir api pages router

# สร้างไฟล์ .env ตามตัวอย่าง
npm run dev   # http://localhost:5173
</code></pre>
          <details class="explain" open><summary>เคล็ดลับให้ผ่านฉลุย</summary><div class="body">
            <ul class="mb-0">
              <li>ชื่อโฟลเดอร์ตอนสร้าง Vite ต้องสอดคล้องกับคำสั่ง <code>cd</code> (เช่นใช้ <code>client</code> ให้ <code>cd client</code>)</li>
              <li>ถ้าเปิดเว็บแล้ว CORS ขัด ให้เช็ค <code>FRONTEND_ORIGIN</code> ฝั่ง backend</li>
            </ul>
          </div></details>
        </div>

        <!-- FRONTEND FILES -->
        <div id="frontend-code" class="mb-5">

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>client/.env</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-env', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-env" class="language-bash">VITE_API_BASE=http://localhost:3000/api
</code></pre>
          <details class="explain" open><summary>สั้นๆ ได้ใจความ</summary><div class="body">
            <ul class="mb-0"><li>กำหนด base URL ให้ axios (เปลี่ยนได้ตอน deploy)</li></ul>
          </div></details>
          </div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>client/package.json</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-pkg', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-pkg" class="language-json">{
  "name": "frontend",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview --open"
  },
  "dependencies": {
    "axios": "^1.11.0",
    "bootstrap": "^5.3.8",
    "bootstrap-icons": "^1.13.1",
    "pinia": "^3.0.3",
    "vue": "^3.5.18",
    "vue-router": "^4.5.1"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.1.4",
    "vite": "^5.4.7"
  }
}
</code></pre>
          <details class="explain" open><summary>จำเฉพาะที่จำเป็น</summary><div class="body">
            <ul class="mb-0"><li><code>dev</code> = พัฒนา, <code>build</code> = ผลิต, <code>preview</code> = ทดสอบไฟล์ build</li></ul>
          </div></details>
          </div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>client/vite.config.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-vite', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-vite" class="language-javascript">import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { fileURLToPath, URL } from 'node:url'
export default defineConfig({
  plugins: [vue()],
  resolve: { alias: { '@': fileURLToPath(new URL('./src', import.meta.url)) } }
})
</code></pre>
          <details class="explain" open><summary>ทำไมต้อง alias @</summary><div class="body">
            <ul class="mb-0"><li>ให้ import สั้นและอ่านง่าย เช่น <code>@/pages/TeachersPage.vue</code></li></ul>
          </div></details>
          </div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>client/src/main.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-main', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-main" class="language-javascript">import { createApp } from 'vue';
import { createPinia } from 'pinia';
import 'bootstrap/dist/css/bootstrap.min.css';
import 'bootstrap-icons/font/bootstrap-icons.css';
import 'bootstrap';
import App from './App.vue';
import router from './router';
createApp(App).use(createPinia()).use(router).mount('#app');
</code></pre>
          <details class="explain" open><summary>บูตระบบ</summary><div class="body">
            <ul class="mb-0"><li>ประกอบ Vue + Pinia + Router + Bootstrap แล้ว mount เข้ากับ <code>#app</code></li></ul>
          </div></details>
          </div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>client/src/router/index.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-router', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-router" class="language-javascript">import { createRouter, createWebHistory } from 'vue-router';
import DashboardPage from '@/pages/DashboardPage.vue';
import PositionsPage from '@/pages/PositionsPage.vue';
import TeachersPage from '@/pages/TeachersPage.vue';
const routes = [
  { path: '/', component: DashboardPage },
  { path: '/positions', component: PositionsPage },
  { path: '/teachers', component: TeachersPage },
];
export default createRouter({ history: createWebHistory(), routes });
</code></pre>
          <details class="explain" open><summary>เส้นทางหลัก 3 หน้า</summary><div class="body">
            <ul class="mb-0"><li>Dashboard / Positions / Teachers</li></ul>
          </div></details>
          </div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>client/src/api/index.js</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-api', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-api" class="language-javascript">import axios from 'axios';
export const api = axios.create({
  baseURL: import.meta.env.VITE_API_BASE || 'http://localhost:3000/api',
  headers: { 'Content-Type': 'application/json' }
});
export function toFormData(obj){
  const fd=new FormData(); Object.entries(obj).forEach(([k,v])=>{
    if(v===undefined || v===null) return; fd.append(k, v);
  }); return fd;
}
</code></pre>
          <details class="explain" open><summary>ชัดๆ 2 ฟังก์ชัน</summary><div class="body">
            <ul class="mb-0">
              <li><code>api</code> = อินสแตนซ์ axios พร้อม baseURL</li>
              <li><code>toFormData</code> = แปลง object เป็น <code>FormData</code> สำหรับอัปโหลดไฟล์</li>
            </ul>
          </div></details>
          </div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>client/src/App.vue</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-app', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-app" class="language-markup">&lt;template&gt;
  &lt;div class="min-vh-100"&gt;
    &lt;nav class="navbar navbar-expand-lg border-bottom sticky-top bg-white"&gt;
      &lt;div class="container"&gt;
        &lt;a class="navbar-brand fw-semibold" href="#"&gt;SystemSchool Management&lt;/a&gt;
        &lt;button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"&gt;
          &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;
        &lt;/button&gt;
        &lt;div id="nav" class="collapse navbar-collapse"&gt;
          &lt;ul class="navbar-nav ms-auto"&gt;
            &lt;li class="nav-item"&gt;&lt;RouterLink class="nav-link" to="/"&gt;Dashboard&lt;/RouterLink&gt;&lt;/li&gt;
            &lt;li class="nav-item"&gt;&lt;RouterLink class="nav-link" to="/teachers"&gt;Teachers&lt;/RouterLink&gt;&lt;/li&gt;
            &lt;li class="nav-item"&gt;&lt;RouterLink class="nav-link" to="/positions"&gt;Positions&lt;/RouterLink&gt;&lt;/li&gt;
          &lt;/ul&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/nav&gt;
    &lt;main class="container py-4"&gt;&lt;RouterView /&gt;&lt;/main&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
          <details class="explain" open><summary>หน้าหลักของแอป</summary><div class="body">
            <ul class="mb-0"><li>Navbar + <code>&lt;RouterView/&gt;</code> สำหรับสลับหน้า</li></ul>
          </div></details>
          </div>

          <!-- Components -->
          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>client/src/components/ConfirmModal.vue</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-modal', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-modal" class="language-markup">&lt;template&gt;
  &lt;div class="modal fade show" tabindex="-1" style="display:block" v-if="open"&gt;
    &lt;div class="modal-dialog"&gt;&lt;div class="modal-content"&gt;
      &lt;div class="modal-header"&gt;
        &lt;h5 class="modal-title"&gt;{{ title }}&lt;/h5&gt;
        &lt;button type="button" class="btn-close" @click="$emit('cancel')" /&gt;
      &lt;/div&gt;
      &lt;div class="modal-body"&gt;&lt;p class="mb-0"&gt;{{ message }}&lt;/p&gt;&lt;/div&gt;
      &lt;div class="modal-footer"&gt;
        &lt;button class="btn btn-outline-secondary" @click="$emit('cancel')"&gt;ยกเลิก&lt;/button&gt;
        &lt;button class="btn btn-danger" @click="$emit('confirm')"&gt;ยืนยัน&lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;&lt;/div&gt;
  &lt;/div&gt;
  &lt;div v-if="open" class="modal-backdrop fade show"&gt;&lt;/div&gt;
&lt;/template&gt;
&lt;script setup&gt;
defineProps({ open:Boolean, title:{type:String,default:'ยืนยันการทำรายการ'}, message:{type:String,default:''} });
defineEmits(['confirm','cancel']);
&lt;/script&gt;
</code></pre>
          <details class="explain" open><summary>ใช้เมื่อไร?</summary><div class="body">
            <ul class="mb-0"><li>ยืนยัน “ลบ/ทำรายการสำคัญ” เพื่อกันเผลอกด</li></ul>
          </div></details>
          </div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>client/src/components/ImageUploader.vue</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-up', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-up" class="language-markup">&lt;template&gt;
  &lt;div class="mb-3"&gt;
    &lt;label class="form-label"&gt;{{ label }}&lt;/label&gt;
    &lt;div class="d-flex align-items-center gap-3"&gt;
      &lt;div class="border rounded d-flex align-items-center justify-content-center bg-light"
           style="width:80px;height:80px;overflow:hidden"&gt;
        &lt;img v-if="preview" :src="preview" class="w-100 h-100 object-fit-cover"&gt;
        &lt;i v-else class="bi bi-image text-secondary"&gt;&lt;/i&gt;
      &lt;/div&gt;
      &lt;input type="file" accept="image/*" class="form-control" @change="onFile"&gt;
      &lt;button v-if="modelValue" type="button" class="btn btn-link text-danger p-0" @click="clearFile"&gt;ลบรูป&lt;/button&gt;
    &lt;/div&gt;
    &lt;div v-if="error" class="form-text text-danger"&gt;{{ error }}&lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script setup&gt;
import { ref, watch } from 'vue';
const props = defineProps({ label:{type:String,default:'รูปภาพ'}, modelValue:File, initialUrl:String, error:String });
const emit = defineEmits(['update:modelValue','remove']); const preview = ref(props.initialUrl || '');
watch(() =&gt; props.modelValue, f =&gt; { preview.value = f ? URL.createObjectURL(f) : (props.initialUrl||''); });
function onFile(e){ const file = e.target.files?.[0]; if(file) emit('update:modelValue', file); }
function clearFile(){ emit('update:modelValue', null); emit('remove'); preview.value=''; }
&lt;/script&gt;
</code></pre>
          <details class="explain" open><summary>พฤติกรรม</summary><div class="body">
            <ul class="mb-0"><li>แสดงภาพตัวอย่างทันทีเมื่อเลือกไฟล์ และกด “ลบรูป” เพื่อล้างค่าได้</li></ul>
          </div></details>
          </div>

          <!-- Pages -->
          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>client/src/pages/PositionsPage.vue</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-pos', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-pos" class="language-markup">&lt;template&gt;
  &lt;section&gt;
    &lt;div class="d-flex justify-content-between align-items-center mb-3"&gt;
      &lt;h2 class="h5 mb-0"&gt;Positions&lt;/h2&gt;
      &lt;form class="d-flex gap-2" @submit.prevent="create"&gt;
        &lt;input v-model="newName" class="form-control" placeholder="ชื่อตำแหน่ง"&gt;
        &lt;button class="btn btn-primary"&gt;เพิ่ม&lt;/button&gt;
      &lt;/form&gt;
    &lt;/div&gt;

    &lt;div class="card"&gt;
      &lt;div class="table-responsive"&gt;
        &lt;table class="table align-middle mb-0"&gt;
          &lt;thead class="table-light"&gt;&lt;tr&gt;&lt;th&gt;ID&lt;/th&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th class="text-end"&gt;Actions&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;
          &lt;tbody&gt;
            &lt;tr v-for="p in positions" :key="p.id"&gt;
              &lt;td&gt;{{ p.id }}&lt;/td&gt;
              &lt;td&gt;
                &lt;input v-if="editId===p.id" v-model="editName" class="form-control"&gt;
                &lt;span v-else&gt;{{ p.name }}&lt;/span&gt;
              &lt;/td&gt;
              &lt;td class="text-end"&gt;
                &lt;template v-if="editId===p.id"&gt;
                  &lt;button class="btn btn-sm btn-outline-secondary me-2" @click="cancelEdit"&gt;ยกเลิก&lt;/button&gt;
                  &lt;button class="btn btn-sm btn-success" @click="saveEdit(p.id)"&gt;บันทึก&lt;/button&gt;
                &lt;/template&gt;
                &lt;template v-else&gt;
                  &lt;button class="btn btn-sm btn-outline-primary me-2" @click="startEdit(p)"&gt;แก้ไข&lt;/button&gt;
                  &lt;button class="btn btn-sm btn-danger" @click="confirmDelete(p)"&gt;ลบ&lt;/button&gt;
                &lt;/template&gt;
              &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr v-if="!positions.length"&gt;&lt;td colspan="3" class="text-center text-muted py-4"&gt;ไม่มีข้อมูล&lt;/td&gt;&lt;/tr&gt;
          &lt;/tbody&gt;
        &lt;/table&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;ConfirmModal :open="modal.open" title="ลบตำแหน่ง"
      :message="'คุณต้องการลบ “'+(modal.name||'')+'” ใช่ไหม?'"
      @confirm="remove(modal.id)" @cancel="modal.open=false" /&gt;
  &lt;/section&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, onMounted } from 'vue';
import { api } from '@/api';
import ConfirmModal from '@/components/ConfirmModal.vue';
const positions = ref([]); const newName = ref(''); const editId = ref(null); const editName = ref('');
const modal = ref({ open:false, id:null, name:'' });
async function load(){ const { data } = await api.get('/positions'); positions.value = data; }
onMounted(load);
async function create(){ if(!newName.value.trim()) return; await api.post('/positions',{ name:newName.value.trim() }); newName.value=''; await load(); }
function startEdit(p){ editId.value=p.id; editName.value=p.name; }
function cancelEdit(){ editId.value=null; editName.value=''; }
async function saveEdit(id){ if(!editName.value.trim()) return; await api.put(`/positions/${id}`,{ name:editName.value.trim() }); cancelEdit(); await load(); }
function confirmDelete(p){ modal.value={ open:true, id:p.id, name:p.name }; }
async function remove(id){ await api.delete(`/positions/${id}`); modal.value.open=false; await load(); }
&lt;/script&gt;
</code></pre>
          <details class="explain" open><summary>สรุป logic</summary><div class="body">
            <ul class="mb-0"><li>โหลด → เพิ่ม → แก้ → ลบ แบบตรงไปตรงมา (inline edit)</li></ul>
          </div></details>
          </div>

          <div class="card mb-3"><div class="card-header d-flex justify-content-between">
            <strong>client/src/pages/TeachersPage.vue</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-tea', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-tea" class="language-markup">&lt;template&gt;
  &lt;section&gt;
    &lt;div class="d-flex justify-content-between align-items-center mb-3"&gt;
      &lt;h2 class="h5 mb-0"&gt;Teachers&lt;/h2&gt;
      &lt;button class="btn btn-primary" @click="openCreate"&gt;&lt;i class="bi bi-plus-lg me-1"&gt;&lt;/i&gt;เพิ่มครู&lt;/button&gt;
    &lt;/div&gt;

    &lt;div class="card mb-3"&gt;
      &lt;div class="table-responsive"&gt;
        &lt;table class="table align-middle mb-0"&gt;
          &lt;thead class="table-light"&gt;
            &lt;tr&gt;&lt;th&gt;รูป&lt;/th&gt;&lt;th&gt;ชื่อ&lt;/th&gt;&lt;th&gt;ตำแหน่ง&lt;/th&gt;&lt;th&gt;โทร&lt;/th&gt;&lt;th class="text-end"&gt;Actions&lt;/th&gt;&lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
            &lt;tr v-for="t in teachers" :key="t.id"&gt;
              &lt;td style="width:72px"&gt;
                &lt;img v-if="t.image_url" :src="t.image_url" style="width:56px;height:56px;object-fit:cover" class="rounded"&gt;
                &lt;span v-else class="text-muted"&gt;-&lt;/span&gt;
              &lt;/td&gt;
              &lt;td&gt;
                &lt;div class="fw-semibold"&gt;{{ t.name }}&lt;/div&gt;
                &lt;div class="text-muted small"&gt;{{ t.address || '-' }}&lt;/div&gt;
              &lt;/td&gt;
              &lt;td&gt;{{ t.position_name || '-' }}&lt;/td&gt;
              &lt;td&gt;{{ t.telephone || '-' }}&lt;/td&gt;
              &lt;td class="text-end"&gt;
                &lt;button class="btn btn-sm btn-outline-primary me-2" @click="openEdit(t)"&gt;แก้ไข&lt;/button&gt;
                &lt;button class="btn btn-sm btn-danger" @click="confirmDelete(t)"&gt;ลบ&lt;/button&gt;
              &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr v-if="!teachers.length"&gt;&lt;td colspan="5" class="text-center text-muted py-4"&gt;ไม่มีข้อมูล&lt;/td&gt;&lt;/tr&gt;
          &lt;/tbody&gt;
        &lt;/table&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- Modal ฟอร์ม --&gt;
    &lt;div class="modal fade show" tabindex="-1" style="display:block" v-if="form.open"&gt;
      &lt;div class="modal-dialog modal-lg"&gt;&lt;div class="modal-content"&gt;
        &lt;div class="modal-header"&gt;
          &lt;h5 class="modal-title"&gt;{{ form.mode==='create' ? 'เพิ่มครู' : 'แก้ไขครู' }}&lt;/h5&gt;
          &lt;button class="btn-close" type="button" @click="form.open=false"&gt;&lt;/button&gt;
        &lt;/div&gt;
        &lt;div class="modal-body"&gt;
          &lt;div class="row g-3"&gt;
            &lt;div class="col-md-6"&gt;&lt;label class="form-label"&gt;ชื่อ&lt;/label&gt;
              &lt;input v-model="form.model.name" class="form-control" placeholder="เช่น สมชาย ใจดี"&gt;
            &lt;/div&gt;
            &lt;div class="col-md-6"&gt;&lt;label class="form-label"&gt;ตำแหน่ง (position_id)&lt;/label&gt;
              &lt;select v-model.number="form.model.position_id" class="form-select"&gt;
                &lt;option :value="0"&gt;-- เลือก --&lt;/option&gt;
                &lt;option v-for="p in positions" :key="p.id" :value="p.id"&gt;{{ p.name }}&lt;/option&gt;
              &lt;/select&gt;
            &lt;/div&gt;
            &lt;div class="col-md-6"&gt;&lt;label class="form-label"&gt;ที่อยู่&lt;/label&gt;
              &lt;input v-model="form.model.address" class="form-control" placeholder="ที่อยู่ (ไม่บังคับ)"&gt;
            &lt;/div&gt;
            &lt;div class="col-md-6"&gt;&lt;label class="form-label"&gt;โทรศัพท์&lt;/label&gt;
              &lt;input v-model="form.model.telephone" class="form-control" placeholder="0xx-xxx-xxxx (ไม่บังคับ)"&gt;
            &lt;/div&gt;
            &lt;div class="col-12"&gt;
              &lt;ImageUploader label="รูปครู" v-model="form.file" :initialUrl="form.model.image_url" /&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="modal-footer"&gt;
          &lt;button class="btn btn-outline-secondary" @click="form.open=false"&gt;ปิด&lt;/button&gt;
          &lt;button class="btn btn-primary" @click="save"&gt;บันทึก&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div v-if="form.open" class="modal-backdrop fade show"&gt;&lt;/div&gt;

    &lt;ConfirmModal :open="modal.open" title="ลบครู"
      :message="'คุณต้องการลบ “'+(modal.name||'')+'” ใช่ไหม?'" @confirm="remove(modal.id)" @cancel="modal.open=false" /&gt;
  &lt;/section&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, reactive, onMounted } from 'vue';
import { api, toFormData } from '@/api';
import ConfirmModal from '@/components/ConfirmModal.vue';
import ImageUploader from '@/components/ImageUploader.vue';

const positions = ref([]); const teachers = ref([]);
const modal = ref({ open:false, id:null, name:'' });
const form = reactive({ open:false, mode:'create', model:{ id:null, name:'', address:'', telephone:'', position_id:0, image_url:'' }, file:null });

async function loadPositions(){ const { data } = await api.get('/positions'); positions.value = data; }
async function loadTeachers(){ const { data } = await api.get('/teachers'); teachers.value = data; }
onMounted(async () => { await loadPositions(); await loadTeachers(); });

function openCreate(){ form.open=true; form.mode='create';
  form.model={ id:null, name:'', address:'', telephone:'', position_id:0, image_url:'' }; form.file=null; }
function openEdit(t){ form.open=true; form.mode='edit';
  form.model={ id:t.id, name:t.name, address:t.address, telephone:t.telephone, position_id:t.position_id||0, image_url:t.image_url||'' }; form.file=null; }

async function save(){
  if(!form.model.name.trim() || !form.model.position_id){ return alert('กรอกชื่อ และเลือกตำแหน่ง'); }
  const payload = { name:form.model.name.trim(), address:form.model.address||'', telephone:form.model.telephone||'', position_id:form.model.position_id };
  if(form.mode==='create'){
    const fd = toFormData(payload); if(form.file) fd.append('image', form.file);
    await api.post('/teachers', fd, { headers:{ 'Content-Type':'multipart/form-data' } });
  }else{
    if(form.file){ const fd = toFormData(payload); fd.append('image', form.file);
      await api.put(`/teachers/${form.model.id}`, fd, { headers:{ 'Content-Type':'multipart/form-data' } }); }
    else{ await api.put(`/teachers/${form.model.id}`, payload); }
  }
  form.open=false; await loadTeachers();
}
function confirmDelete(t){ modal.value={ open:true, id:t.id, name:t.name }; }
async function remove(id){ await api.delete(`/teachers/${id}`); modal.value.open=false; await loadTeachers(); }
&lt;/script&gt;
</code></pre>
          <details class="explain" open><summary>ฟอร์มเดียวทำได้ทั้ง “เพิ่ม” และ “แก้ไข”</summary><div class="body">
            <ul class="mb-0">
              <li>ควบคุมด้วย <code>form.mode</code> (create/edit)</li>
              <li>มีไฟล์ → ใช้ <code>multipart/form-data</code>, ไม่มีไฟล์ → ส่ง JSON ปกติ</li>
            </ul>
          </div></details>
          </div>

          <div class="card"><div class="card-header d-flex justify-content-between">
            <strong>client/src/pages/DashboardPage.vue</strong><button class="btn btn-sm copy-btn" onclick="copyBlock('fe-dash', this)">คัดลอก</button></div>
<pre class="m-0"><code id="fe-dash" class="language-markup">&lt;template&gt;
  &lt;div class="container py-4"&gt;
    &lt;div class="text-center p-5 bg-light rounded shadow-sm mb-5"&gt;
      &lt;h1 class="fw-bold mb-3"&gt;ยินดีต้อนรับสู่ SystemSchool Management&lt;/h1&gt;
      &lt;p class="lead text-muted mb-2"&gt;ระบบจัดการข้อมูลครูและตำแหน่ง&lt;/p&gt;
      &lt;small class="text-secondary"&gt;เพื่อการจัดการข้อมูลครูและตำแหน่งอย่างมีประสิทธิภาพ&lt;/small&gt;
    &lt;/div&gt;

    &lt;div class="card shadow-sm mb-5"&gt;
      &lt;div class="card-body"&gt;
        &lt;h2 class="card-title text-center mb-4"&gt;Technology Stack&lt;/h2&gt;
        &lt;div class="row g-4 text-center"&gt;
          &lt;div v-for="tech in techStack" :key="tech.name" class="col-6 col-md-4 col-lg-2"&gt;
            &lt;div class="card h-100 border-0 shadow-sm hover-card"&gt;
              &lt;div class="card-body d-flex flex-column align-items-center"&gt;
                &lt;img :src="tech.logo" :alt="tech.name" class="img-fluid mb-3" style="max-height: 60px; object-fit: contain;" /&gt;
                &lt;h6 class="fw-bold"&gt;{{ tech.name }}&lt;/h6&gt;
                &lt;p class="text-muted small mb-0"&gt;{{ tech.desc }}&lt;/p&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="text-center mt-4"&gt;
          &lt;span class="badge rounded-pill bg-primary"&gt;Frontend&lt;/span&gt;
          &lt;span class="badge rounded-pill bg-success ms-2"&gt;Backend&lt;/span&gt;
          &lt;span class="badge rounded-pill text-white ms-2" style="background:#06b6d4"&gt;Database&lt;/span&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class="row g-4"&gt;
      &lt;div v-for="action in quickActions" :key="action.title" class="col-md-6"&gt;
        &lt;div class="card shadow-sm h-100 hover-card"&gt;
          &lt;div class="card-body"&gt;
            &lt;h5 class="card-title fw-bold mb-3"&gt;{{ action.title }}&lt;/h5&gt;
            &lt;p class="card-text text-muted"&gt;{{ action.description }}&lt;/p&gt;
            &lt;div class="d-flex flex-wrap gap-2"&gt;
              &lt;span v-for="badge in action.badges" :key="badge.text" class="badge rounded-pill" :class="badge.color"&gt;{{ badge.text }}&lt;/span&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
const techStack = [
  { name: 'Vite', desc: 'Build Tool', logo: 'https://upload.wikimedia.org/wikipedia/commons/f/f1/Vitejs-logo.svg' },
  { name: 'Node.js', desc: 'Runtime', logo: 'https://upload.wikimedia.org/wikipedia/commons/d/d9/Node.js_logo.svg' },
  { name: 'Bootstrap CSS', desc: 'CSS Framework', logo: 'https://ehaboo.github.io/my-resume/assets/images/Bootstrap-img.png' },
  { name: 'Vue', desc: 'Frontend', logo: 'https://upload.wikimedia.org/wikipedia/commons/9/95/Vue.js_Logo_2.svg' },
  { name: 'MySQL', desc: 'Database', logo: 'https://upload.wikimedia.org/wikipedia/commons/0/0a/MySQL_textlogo.svg' },
  { name: 'Express.js', desc: 'Backend', logo: 'https://upload.wikimedia.org/wikipedia/commons/6/64/Expressjs.png' },
];
const quickActions = [
  { title: 'การจัดการตำแหน่ง', description: 'จัดการข้อมูลตำแหน่งงานต่างๆ ในโรงเรียน',
    badges: [ { text:'CRUD Operations', color:'bg-primary text-white' }, { text:'Modal Forms', color:'bg-success text-white' } ] },
  { title: 'การจัดการครู', description: 'จัดการข้อมูลครูและบุคลากรในโรงเรียน',
    badges: [ { text:'Profile Management', color:'bg-dark text-white' }, { text:'Image Upload', color:'bg-warning text-dark' } ] }
];
&lt;/script&gt;

&lt;style scoped&gt;
.hover-card{transition:transform .2s ease, box-shadow .2s ease}
.hover-card:hover{transform:translateY(-5px);box-shadow:0 6px 15px rgba(0,0,0,.08)}
&lt;/style&gt;
</code></pre>
          <details class="explain" open><summary>มีไว้ทำไม?</summary><div class="body">
            <ul class="mb-0"><li>เป็นหน้า Landing อธิบายสแต็ก + ชุดคำสั่ง/ฟีเจอร์หลัก</li></ul>
          </div></details>
          </div>

        </div> <!-- /frontend-code -->

      </section>
    </div>
  </main>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sql.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
  <script>
    function copyBlock(id, btn){
      const el = document.getElementById(id); if(!el) return;
      navigator.clipboard.writeText(el.innerText).then(()=>{
        const keep = btn.innerHTML; btn.innerHTML = 'คัดลอกแล้ว'; setTimeout(()=>btn.innerHTML = keep, 1200);
      });
    }
    // เปิดคำอธิบายทั้งหมดเป็นค่าเริ่มต้น
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('details.explain').forEach(d => d.open = true);
    });
  </script>
</body>
</html>
